---
title: "Add a New User Credential"
sidebar_position: 6
description: Add a Credential to an Existing Wallet
slug: /embedded-wallets/code-examples/add-credential
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import Parameter from "@site/src/components/parameter";

## Overview

This guide demonstrates how to add a new credential (specifically, a passkey) to an existing wallet using the Turnkey SDK.

### Initialize the Passkey Client

Begin by initializing the Turnkey SDK with your organization ID and API base URL, and then initialize the Passkey Client.

```typescript
import { Turnkey } from "@turnkey/sdk-browser";

// Initialize the Turnkey SDK with your organization credentials
const turnkey = new Turnkey({
  rpId: process.env.TURNKEY_RP_ID, // Your relying party ID
  apiBaseUrl: process.env.TURNKEY_API_BASE_URL, // Turnkey API base URL
  defaultOrganizationId: process.env.TURNKEY_ORGANIZATION_ID, // Your organization ID
});

// Initialize the Passkey Client
const passkeyClient = turnkey.passkeyClient();
```

### Authenticate the User

Now that you have initialized the Passkey Client, you can call the `login` function which will prompt the
user to authenticate with their passkey. Additionally, this function will set the current user in
local storage upon successful authentication, which will be used later when creating an additional authenticator.

```typescript
const response = await passkeyClient.login();
if (response.organizationId) {
  console.log("User authenticated successfully");
} else {
  console.log("User authentication failed");
}
```

### Create User Passkey

Now that you have authenticated the user, you can call the `createUserPasskey` function to create a new user passkey credential.

```typescript
const credential = await passkeyClient.createUserPasskey({
  publicKey: {
    // This is the name of the passkey that will be displayed to the user
    rp: {
      name: "Wallet Passkey",
    },
    user: {
      name: "satoshi",
      displayName: "Satoshi",
    },
  },
});
```

### Add the credential to the wallet

Now that you have created a new user passkey credential, we'll use this credential to create a new passkey authenticator for the user.
We'll need the userId to create the authenticator, so we'll get the current user first. This value comes from local storage which was
set in the previous step when the user successfully authenticated via the `login` function.

```typescript
// First, get the current user, we'll need the userId to create the authenticator
const user = await turnkey?.getCurrentUser();

const authenticatorsResponse = await turnkey.createAuthenticators({
  authenticators: [
    {
      authenticatorName: "New Passkey Authenticator",
      challenge: credential.encodedChallenge,
      attestation: credential.attestation,
    },
  ],
  userId: user.userId,
});

// Check if the authenticator was created successfully
if (authenticatorsResponse?.activity.id) {
  console.log("Authenticator created successfully");
}
```

## Conclusion

In this guide, we've walked through the process of adding a new credential to an existing wallet using the Turnkey SDK.
By following these steps, you can improve the usability of your application by allowing users to create multiple authentication methods.
This flexibility enables users to add a hardware security device like a Yubikey, or a native passkey via providers like iCloud keychain or 1Password,
enhancing their overall experience with your application.

For a complete example, check out our [demo embedded wallet](https://github.com/tkhq/demo-embedded-wallet/blob/main/src/components/add-passkey.tsx).
